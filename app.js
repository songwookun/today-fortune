/* ===================================================
   오늘의 운세 — app.js
   Pure JS · No dependencies · Static site
   =================================================== */

'use strict';

/* ─────────────────────────────────────
   1. PRNG & Hashing Utilities
   ───────────────────────────────────── */

/** Cyrb53 — fast, good-distribution string hash → 53-bit integer */
function hashString(str, seed = 0) {
  let h1 = 0xdeadbeef ^ seed;
  let h2 = 0x41c6ce57 ^ seed;
  for (let i = 0; i < str.length; i++) {
    const ch = str.charCodeAt(i);
    h1 = Math.imul(h1 ^ ch, 2654435761);
    h2 = Math.imul(h2 ^ ch, 1597334677);
  }
  h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);
  h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);
  return 4294967296 * (2097151 & h2) + (h1 >>> 0);
}

/** Mulberry32 — seeded 32-bit PRNG, returns function that yields [0,1) */
function mulberry32(seed) {
  let s = seed | 0;
  return function () {
    s = (s + 0x6d2b79f5) | 0;
    let t = Math.imul(s ^ (s >>> 15), 1 | s);
    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

/** Get today's date string (YYYY-MM-DD) in local timezone */
function getTodayStr() {
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const dd = String(d.getDate()).padStart(2, '0');
  return `${yyyy}-${mm}-${dd}`;
}

/* ─────────────────────────────────────
   2. Tarot Data — 12 templates × 3 categories
   ───────────────────────────────────── */

const ARCHETYPES = [
  { symbol: '⭐', name: '별' },
  { symbol: '🌙', name: '달' },
  { symbol: '☀️', name: '태양' },
  { symbol: '⚡', name: '탑' },
  { symbol: '☸️', name: '수레바퀴' },
  { symbol: '🔮', name: '은둔자' },
  { symbol: '🦁', name: '힘' },
  { symbol: '💞', name: '연인' },
  { symbol: '✨', name: '마법사' },
  { symbol: '👑', name: '황제' },
  { symbol: '🌊', name: '여사제' },
  { symbol: '🌍', name: '세계' },
];

/** Lucky data per archetype index — used in 심화 리포트 */
const LUCKY_DATA = [
  { color: '보라색', number: 7, direction: '북쪽', time: '오후 9시', element: '물' },
  { color: '은색', number: 2, direction: '서쪽', time: '자정', element: '물' },
  { color: '노란색', number: 1, direction: '남쪽', time: '정오', element: '불' },
  { color: '빨간색', number: 16, direction: '동쪽', time: '오후 3시', element: '불' },
  { color: '파란색', number: 10, direction: '북동쪽', time: '오전 10시', element: '바람' },
  { color: '남색', number: 9, direction: '북서쪽', time: '새벽 4시', element: '땅' },
  { color: '금색', number: 8, direction: '남동쪽', time: '오전 7시', element: '불' },
  { color: '분홍색', number: 6, direction: '남서쪽', time: '오후 6시', element: '바람' },
  { color: '주황색', number: 1, direction: '동쪽', time: '오전 9시', element: '바람' },
  { color: '검정색', number: 4, direction: '북쪽', time: '오후 2시', element: '땅' },
  { color: '흰색', number: 2, direction: '서쪽', time: '오후 11시', element: '물' },
  { color: '초록색', number: 21, direction: '중앙', time: '오후 5시', element: '땅' },
];

/** Combo messages based on the combination of 3 archetype energy types */
const COMBO_MESSAGES = [
  '오늘의 카드 조합은 강한 직관과 행동력을 나타냅니다. 느낌이 올 때 과감히 움직여 보세요.',
  '세 카드가 안정과 균형의 에너지를 보여줍니다. 차분하게 하루를 보내면 좋은 결과가 있을 거예요.',
  '변화와 성장의 기운이 강합니다. 새로운 것을 시도하기에 좋은 날이에요.',
  '내면의 지혜와 외적 활력이 조화를 이루는 특별한 조합입니다.',
  '도전과 기회가 공존하는 날입니다. 중요한 결정을 내리기에 적합해요.',
  '감정적 깊이와 실천적 에너지가 만나 풍요로운 하루가 될 수 있습니다.',
  '창의성과 실용성이 함께하는 조합입니다. 아이디어를 현실로 만들어 보세요.',
  '오늘의 카드들은 인내와 보상의 메시지를 전합니다. 꾸준함이 빛을 발할 거예요.',
  '사랑과 풍요의 에너지가 흐르는 조합입니다. 감사하는 마음으로 하루를 보내세요.',
  '강한 결단력과 섬세한 감성이 공존합니다. 이성과 감성의 균형을 잡아보세요.',
  '세 카드 모두 긍정적인 변화를 예고합니다. 오늘은 작은 모험을 즐겨보세요.',
  '지혜, 용기, 사랑의 삼박자가 갖춰진 하루입니다. 무엇이든 할 수 있어요.',
];

/**
 * 추천 콘텐츠 — 아키타입(0~11) 별 3개씩
 * 카드 결과에 따라 동적으로 추천
 * href는 향후 실제 제휴 링크로 교체
 */
const RECOMMENDATIONS = [
  /* 0 별 (Star) */ [
    { emoji: '🌟', name: '긍정 확언 100선', desc: '하루를 여는 희망의 문장', tag: '자기계발' },
    { emoji: '🧘', name: '희망을 부르는 5분 명상', desc: '짧지만 강력한 마음 리셋', tag: '명상' },
    { emoji: '📖', name: '소원 성취 카드 가이드', desc: '원하는 것을 현실로 끌어당기기', tag: '운세' },
  ],
  /* 1 달 (Moon) */ [
    { emoji: '🌜', name: '꿈 해석 완벽 가이드', desc: '잠 속 메시지를 읽는 법', tag: '심리' },
    { emoji: '🎵', name: '수면 유도 ASMR', desc: '깊은 잠을 위한 사운드', tag: '힐링' },
    { emoji: '📓', name: '감정 일기 작성법', desc: '마음을 글로 정리하는 습관', tag: '자기관리' },
  ],
  /* 2 태양 (Sun) */ [
    { emoji: '☀️', name: '활력 모닝 루틴', desc: '아침을 바꾸면 하루가 달라져요', tag: '생활' },
    { emoji: '🏃', name: '초보 러닝 가이드', desc: '오늘부터 시작하는 달리기', tag: '운동' },
    { emoji: '🎶', name: '에너지 충전 플레이리스트', desc: '기분 UP 음악 모음', tag: '음악' },
  ],
  /* 3 탑 (Tower) */ [
    { emoji: '📖', name: '변화를 받아들이는 기술', desc: '위기를 성장으로 바꾸는 마인드', tag: '자기계발' },
    { emoji: '🧘', name: '스트레스 해소 호흡법', desc: '3분 호흡으로 마음 진정', tag: '명상' },
    { emoji: '💪', name: '위기 극복 사고법', desc: '어려울수록 강해지는 멘탈 훈련', tag: '자기계발' },
  ],
  /* 4 수레바퀴 (Wheel) */ [
    { emoji: '🔄', name: '인생 사이클 이해하기', desc: '변화의 패턴을 읽는 심리 가이드', tag: '심리' },
    { emoji: '📅', name: '운명의 타이밍 활용법', desc: '기회를 포착하는 감각 기르기', tag: '자기계발' },
    { emoji: '🌿', name: '계절별 건강 관리법', desc: '자연의 리듬에 맞춘 셀프케어', tag: '건강' },
  ],
  /* 5 은둔자 (Hermit) */ [
    { emoji: '🧘', name: '혼자만의 명상 가이드', desc: '고요 속에서 나를 만나는 시간', tag: '명상' },
    { emoji: '📚', name: '내면 탐구 필독서 5선', desc: '깊은 성찰을 위한 책 추천', tag: '도서' },
    { emoji: '🍵', name: '힐링 티타임 레시피', desc: '나를 위한 따뜻한 한 잔', tag: '생활' },
  ],
  /* 6 힘 (Strength) */ [
    { emoji: '💪', name: '멘탈 강화 30일 챌린지', desc: '매일 하나씩 강해지는 습관', tag: '자기계발' },
    { emoji: '🏋️', name: '홈트레이닝 입문', desc: '집에서 시작하는 체력 만들기', tag: '운동' },
    { emoji: '📖', name: '회복탄력성 키우는 법', desc: '넘어져도 다시 일어나는 힘', tag: '심리' },
  ],
  /* 7 연인 (Lovers) */ [
    { emoji: '💕', name: '사랑의 언어 테스트', desc: '나와 상대의 사랑 스타일 알기', tag: '관계' },
    { emoji: '🎵', name: '로맨틱 재즈 플레이리스트', desc: '분위기를 살리는 음악 모음', tag: '음악' },
    { emoji: '🍽️', name: '특별한 홈쿠킹 레시피', desc: '사랑을 담은 요리 한 상', tag: '생활' },
  ],
  /* 8 마법사 (Magician) */ [
    { emoji: '✨', name: '목표 달성 워크시트', desc: '꿈을 계획으로 바꾸는 도구', tag: '자기계발' },
    { emoji: '🎨', name: '창의력 30일 프로젝트', desc: '매일 새로운 영감 깨우기', tag: '크리에이티브' },
    { emoji: '📱', name: '생산성 앱 TOP 5', desc: '시간을 2배로 쓰는 비결', tag: '테크' },
  ],
  /* 9 황제 (Emperor) */ [
    { emoji: '📊', name: '초보 재정 관리 가이드', desc: '돈의 흐름을 잡는 첫걸음', tag: '재테크' },
    { emoji: '👔', name: '리더십 무료 강의', desc: '존경받는 리더가 되는 법', tag: '자기계발' },
    { emoji: '📋', name: '하루 계획 템플릿', desc: '체계적인 하루를 만드는 도구', tag: '생산성' },
  ],
  /* 10 여사제 (Priestess) */ [
    { emoji: '🔮', name: '운세 카드 심화 학습', desc: '카드 해석의 다음 단계로', tag: '운세' },
    { emoji: '🧠', name: '직관력 개발 가이드', desc: '숨겨진 감각을 깨우는 훈련', tag: '심리' },
    { emoji: '🌿', name: '아로마테라피 입문', desc: '향기로 마음을 다스리는 법', tag: '힐링' },
  ],
  /* 11 세계 (World) */ [
    { emoji: '🌍', name: '버킷리스트 100 가이드', desc: '인생에서 꼭 해보고 싶은 것들', tag: '생활' },
    { emoji: '✈️', name: '힐링 여행지 추천', desc: '몸과 마음을 충전하는 여행', tag: '여행' },
    { emoji: '🎯', name: '인생 로드맵 만들기', desc: '큰 그림으로 내 삶을 설계', tag: '자기계발' },
  ],
];

const TAROT = {
  love: [
    {
      title: '별',
      coreMessage: '오늘 당신의 연애운에 희망의 빛이 비칩니다. 설렘과 기대가 마음을 채우는 하루입니다.',
      details: [
        '좋은 인연이 가까이 다가오고 있을 수 있습니다.',
        '누군가의 진심 어린 말이 당신에게 위로가 됩니다.',
        '과거의 아픔을 내려놓으면 새로운 시작이 열립니다.',
        '마음을 열면 의외의 곳에서 따뜻함을 느끼게 됩니다.',
        '작은 용기가 관계에 큰 변화를 만들 수 있습니다.',
        '당신이 먼저 다가가면 상대도 마음을 열 것입니다.',
      ],
      doActions: [
        '먼저 따뜻한 인사를 건네보세요.',
        '마음에 드는 사람에게 솔직한 감정을 전해보세요.',
        '오래된 친구에게 연락해 보세요.',
        '상대의 작은 변화를 알아차려 칭찬해 주세요.',
        '함께 산책하며 대화하는 시간을 가져보세요.',
        '감사의 마음을 표현해 보세요.',
      ],
      dontActions: [
        '상대의 감정을 추측으로 판단하지 마세요.',
        '과거 연애의 패턴에 얽매이지 마세요.',
        '감정을 억누르고 혼자 끙끙 앓지 마세요.',
        '지나친 기대로 상대를 압박하지 마세요.',
        'SNS 속 타인의 연애와 비교하지 마세요.',
        '불안함 때문에 집착으로 표현하지 마세요.',
      ],
    },
    {
      title: '달',
      coreMessage: '감정의 깊은 곳에서 진실이 드러나는 날입니다. 직감을 믿고 마음의 소리에 귀 기울여 보세요.',
      details: [
        '말로 표현하지 못한 감정이 행동으로 드러날 수 있습니다.',
        '상대의 숨겨진 마음을 느끼게 되는 순간이 올 수 있습니다.',
        '꿈이나 직감이 관계의 방향을 알려줄 수 있습니다.',
        '오해가 풀리고 진심이 전해지는 계기가 생깁니다.',
        '조용한 시간 속에서 관계의 의미를 깨달을 수 있습니다.',
        '감정의 파도가 지나면 더 깊은 이해가 남습니다.',
      ],
      doActions: [
        '조용한 곳에서 자신의 감정을 정리해 보세요.',
        '상대의 말 뒤에 숨겨진 의도를 생각해 보세요.',
        '일기를 써서 마음을 정리해 보세요.',
        '감정적인 결정은 하루 미루어 보세요.',
        '진실한 대화를 시도해 보세요.',
        '자신의 직감을 존중해 보세요.',
      ],
      dontActions: [
        '감정적으로 충동적인 연락을 하지 마세요.',
        '불확실한 정보로 상대를 의심하지 마세요.',
        '혼자만의 상상으로 관계를 판단하지 마세요.',
        '밤늦은 시간에 중요한 대화를 시작하지 마세요.',
        '감정을 억지로 숨기려 하지 마세요.',
        '상대의 침묵을 부정적으로만 해석하지 마세요.',
      ],
    },
    {
      title: '태양',
      coreMessage: '밝고 따뜻한 에너지가 관계를 감싸는 하루입니다. 사랑이 빛나는 순간을 즐기세요.',
      details: [
        '자신감이 매력을 더해주는 하루입니다.',
        '함께하는 시간이 특별한 추억이 됩니다.',
        '웃음이 넘치는 대화가 관계를 더 가깝게 합니다.',
        '솔직한 표현이 긍정적인 반응을 이끌어 냅니다.',
        '만남의 기회가 자연스럽게 찾아올 수 있습니다.',
        '상대와의 공통점을 발견하는 즐거움이 있습니다.',
      ],
      doActions: [
        '밝은 에너지로 상대에게 다가가 보세요.',
        '함께 즐길 수 있는 활동을 제안해 보세요.',
        '진심 어린 칭찬을 아끼지 마세요.',
        '새로운 장소에서의 데이트를 계획해 보세요.',
        '사진을 찍어 좋은 순간을 기록하세요.',
        '상대의 꿈과 목표에 관심을 가져보세요.',
      ],
      dontActions: [
        '좋은 기분에 취해 무리한 약속을 하지 마세요.',
        '관계의 속도를 너무 빠르게 올리지 마세요.',
        '자만심으로 상대의 감정을 가볍게 여기지 마세요.',
        '즐거움에만 집중해 중요한 대화를 미루지 마세요.',
        '외모에만 신경 쓰고 내면을 소홀히 하지 마세요.',
        '상대의 의견을 무시하고 혼자 결정하지 마세요.',
      ],
    },
    {
      title: '탑',
      coreMessage: '예상치 못한 변화가 관계에 새 바람을 불어넣습니다. 변화를 두려워하지 말고 성장의 기회로 삼으세요.',
      details: [
        '갑작스러운 연락이나 소식이 있을 수 있습니다.',
        '관계에서 중요한 전환점을 맞이할 수 있습니다.',
        '불편했던 감정이 정리되는 계기가 생깁니다.',
        '솔직한 대화가 관계를 새롭게 할 수 있습니다.',
        '변화 속에서 진짜 중요한 것이 무엇인지 깨닫게 됩니다.',
        '예상 밖의 상황이 오히려 관계를 단단하게 합니다.',
      ],
      doActions: [
        '변화에 유연하게 대처하세요.',
        '솔직하게 자신의 감정을 표현해 보세요.',
        '상대의 입장에서 한번 생각해 보세요.',
        '필요하다면 용기 있게 결단을 내리세요.',
        '변화 속에서 긍정적인 면을 찾아보세요.',
        '신뢰할 수 있는 사람에게 조언을 구해보세요.',
      ],
      dontActions: [
        '변화를 무조건 피하려고 하지 마세요.',
        '감정적으로 극단적인 선택을 하지 마세요.',
        '상대를 탓하며 화를 쏟아내지 마세요.',
        '과거에 연연하며 앞으로 나아가지 못하지 마세요.',
        '불안을 술이나 충동으로 해소하지 마세요.',
        '중요한 결정을 감정이 격앙된 상태에서 내리지 마세요.',
      ],
    },
    {
      title: '수레바퀴',
      coreMessage: '인연의 흐름이 새로운 방향으로 움직이고 있습니다. 자연스러운 흐름을 믿어보세요.',
      details: [
        '우연한 만남이 중요한 인연으로 이어질 수 있습니다.',
        '관계의 사이클이 새로운 국면에 접어들고 있습니다.',
        '멀어졌던 인연이 다시 가까워질 수 있습니다.',
        '운명적인 타이밍이 당신을 안내하고 있습니다.',
        '변화의 흐름에 몸을 맡기면 좋은 결과가 옵니다.',
        '지금의 상황이 영원하지 않음을 기억하세요.',
      ],
      doActions: [
        '새로운 사람과의 만남에 마음을 열어보세요.',
        '기회가 왔을 때 망설이지 마세요.',
        '연락을 기다리기보다 먼저 시작해 보세요.',
        '관계에서 자연스러운 흐름을 존중하세요.',
        '변화를 긍정적으로 받아들이세요.',
        '새로운 모임이나 활동에 참여해 보세요.',
      ],
      dontActions: [
        '무리하게 관계를 붙잡으려 하지 마세요.',
        '운명이라는 이름으로 경고 신호를 무시하지 마세요.',
        '변화 없는 반복에 안주하지 마세요.',
        '상대를 자신의 뜻대로 바꾸려 하지 마세요.',
        '불안함에 성급한 고백이나 결정을 하지 마세요.',
        '흘러가는 인연을 억지로 잡으려 하지 마세요.',
      ],
    },
    {
      title: '은둔자',
      coreMessage: '혼자만의 시간이 관계의 답을 찾아줄 수 있는 날입니다. 내면을 들여다보세요.',
      details: [
        '자기 자신을 먼저 이해하면 관계도 좋아집니다.',
        '조용한 성찰이 올바른 선택으로 이어집니다.',
        '혼자 보내는 시간이 관계의 질을 높여줍니다.',
        '내면의 평화가 올바른 판단력을 줍니다.',
        '급하지 않게, 천천히 마음을 정리해 보세요.',
        '때로는 거리를 두는 것이 서로에게 좋습니다.',
      ],
      doActions: [
        '혼자만의 시간을 계획해 보세요.',
        '명상이나 산책으로 마음을 정리하세요.',
        '자신이 진정 원하는 관계가 무엇인지 생각해 보세요.',
        '좋아하는 책이나 영화로 영감을 얻어보세요.',
        '감정 일기를 써서 패턴을 파악해 보세요.',
        '자기돌봄에 시간을 투자하세요.',
      ],
      dontActions: [
        '외로움에 쫓겨 아무나 만나지 마세요.',
        '상대에게 지나치게 의존하지 마세요.',
        '혼자 있는 시간을 불안해하지 마세요.',
        '자기 감정을 무시하고 맞추려 하지 마세요.',
        'SNS를 통해 상대를 감시하지 마세요.',
        '혼자라는 이유로 자신을 비하하지 마세요.',
      ],
    },
    {
      title: '힘',
      coreMessage: '내면의 힘으로 관계의 어려움을 극복할 수 있는 하루입니다. 부드러움 속에 강인함을 담으세요.',
      details: [
        '참을성과 이해심이 관계를 한층 깊게 합니다.',
        '어려운 상황에서도 차분함을 유지할 수 있습니다.',
        '당신의 진심이 상대의 마음을 움직일 수 있습니다.',
        '갈등 속에서도 사랑을 잃지 않는 것이 진정한 강인함입니다.',
        '포기하지 않는 마음이 좋은 결과를 만듭니다.',
        '부드러운 말 한마디가 단단한 벽을 허뭅니다.',
      ],
      doActions: [
        '어려운 대화도 피하지 말고 다가가 보세요.',
        '상대의 약점을 이해하고 품어주세요.',
        '인내심을 가지고 관계의 성장을 기다려 보세요.',
        '갈등 상황에서 차분하게 대처하세요.',
        '자신의 감정을 솔직하되 부드럽게 전달하세요.',
        '작은 것부터 용서하는 연습을 해보세요.',
      ],
      dontActions: [
        '화가 나도 폭발적으로 표현하지 마세요.',
        '약한 모습을 보이는 것을 두려워하지 마세요.',
        '힘으로 상대를 제압하려 하지 마세요.',
        '상대를 바꾸려는 집착을 내려놓으세요.',
        '참기만 하고 소통하지 않는 것은 피하세요.',
        '자존심 때문에 사과할 기회를 놓치지 마세요.',
      ],
    },
    {
      title: '연인',
      coreMessage: '마음과 마음이 깊이 연결되는 특별한 날입니다. 진심이 통하는 순간을 놓치지 마세요.',
      details: [
        '특별한 감정적 교류가 있을 수 있습니다.',
        '서로에 대한 이해가 깊어지는 시간입니다.',
        '중요한 선택의 순간에서 마음이 이끄는 대로 가보세요.',
        '함께하는 것의 소중함을 느끼는 하루입니다.',
        '공감과 배려가 관계를 더욱 풍요롭게 합니다.',
        '사랑하는 사람과의 시간이 가장 값진 선물입니다.',
      ],
      doActions: [
        '사랑하는 사람에게 마음을 전해보세요.',
        '함께 의미 있는 시간을 보내보세요.',
        '상대의 이야기에 귀 기울여 주세요.',
        '작은 서프라이즈를 준비해 보세요.',
        '둘만의 특별한 약속을 만들어 보세요.',
        '상대의 사랑 표현 방식을 이해하려 노력하세요.',
      ],
      dontActions: [
        '당연하다는 태도로 상대를 대하지 마세요.',
        '감정 표현을 아끼며 쿨한 척하지 마세요.',
        '휴대폰만 보며 함께하는 시간을 낭비하지 마세요.',
        '상대의 사소한 실수에 예민하게 굴지 마세요.',
        '관계에서 주는 것만 계산하지 마세요.',
        '중요한 감정을 문자로만 전하려 하지 마세요.',
      ],
    },
    {
      title: '마법사',
      coreMessage: '당신의 매력이 빛을 발하는 하루입니다. 자신감을 가지고 적극적으로 표현하세요.',
      details: [
        '당신의 말 한마디가 큰 영향력을 가집니다.',
        '새로운 시도가 관계에 활력을 줍니다.',
        '창의적인 표현이 상대의 마음을 사로잡습니다.',
        '의지와 행동력이 좋은 결과를 만듭니다.',
        '주도적으로 관계를 이끌어 갈 수 있는 날입니다.',
        '당신에게는 상황을 바꿀 수 있는 능력이 있습니다.',
      ],
      doActions: [
        '자신감 있게 상대에게 다가가 보세요.',
        '특별한 데이트 코스를 기획해 보세요.',
        '새로운 취미를 함께 시작해 보세요.',
        '상대에게 당신의 매력을 어필해 보세요.',
        '대화를 주도하며 분위기를 이끌어 보세요.',
        '첫인상이 중요한 만남에 적극적으로 임하세요.',
      ],
      dontActions: [
        '과도한 자신감으로 상대를 무시하지 마세요.',
        '말만 앞세우고 행동이 뒤따르지 않으면 안 됩니다.',
        '상대를 조종하려는 의도를 가지지 마세요.',
        '외적인 것에만 집중하지 마세요.',
        '거짓으로 자신을 꾸미지 마세요.',
        '결과만 급하게 좇지 마세요.',
      ],
    },
    {
      title: '황제',
      coreMessage: '안정적이고 든든한 관계 에너지가 흐르는 날입니다. 책임감 있는 모습이 신뢰를 쌓습니다.',
      details: [
        '안정감을 주는 행동이 관계를 단단히 합니다.',
        '약속을 지키는 것이 가장 큰 사랑의 표현입니다.',
        '현실적인 계획이 관계의 미래를 밝게 합니다.',
        '리더십을 발휘하되 독단적이지 않게 하세요.',
        '일관된 태도가 상대에게 안정감을 줍니다.',
        '진지한 대화가 관계를 한 단계 발전시킵니다.',
      ],
      doActions: [
        '한 약속은 반드시 지키세요.',
        '관계의 미래에 대해 진지하게 이야기해 보세요.',
        '상대의 안전과 편안함을 챙겨주세요.',
        '현실적인 계획을 함께 세워보세요.',
        '흔들리지 않는 모습을 보여주세요.',
        '책임감 있는 결정을 내려보세요.',
      ],
      dontActions: [
        '지나친 통제로 상대의 자유를 침해하지 마세요.',
        '감정 표현을 등한시하지 마세요.',
        '일방적으로 결정하고 통보하지 마세요.',
        '권위적인 태도로 상대를 대하지 마세요.',
        '업무적인 태도로 관계를 운영하지 마세요.',
        '유연성 없이 고집만 부리지 마세요.',
      ],
    },
    {
      title: '여사제',
      coreMessage: '직감을 따르면 사랑의 길이 보이는 날입니다. 내면의 지혜를 믿으세요.',
      details: [
        '느낌이 이끄는 대로 따라가 보세요.',
        '상대의 말보다 행동을 관찰하면 진실이 보입니다.',
        '서두르지 않으면 자연스럽게 길이 열립니다.',
        '침묵 속에서 더 많은 것을 느낄 수 있습니다.',
        '보이지 않는 연결고리를 발견하게 됩니다.',
        '내면의 평화가 올바른 사랑으로 이끕니다.',
      ],
      doActions: [
        '마음이 편한 사람에게 끌려가 보세요.',
        '상대를 관찰하되 판단하지 마세요.',
        '직감이 보내는 신호에 귀 기울이세요.',
        '조용히 상대의 행동 패턴을 살펴보세요.',
        '명상을 통해 마음의 답을 찾아보세요.',
        '서두르지 않고 기다리는 여유를 가지세요.',
      ],
      dontActions: [
        '논리로만 감정을 분석하려 하지 마세요.',
        '상대의 모든 것을 당장 알려 하지 마세요.',
        '직감을 무시하고 남의 말만 따르지 마세요.',
        '조급함에 결론을 서두르지 마세요.',
        '신비로운 분위기를 깨는 무례한 행동을 하지 마세요.',
        '감을 잡았다고 확정 짓지 마세요.',
      ],
    },
    {
      title: '세계',
      coreMessage: '관계에서 한 단계 성장하는 뜻깊은 하루입니다. 완성과 새 시작이 공존합니다.',
      details: [
        '관계의 성숙함을 느끼는 순간이 올 수 있습니다.',
        '하나의 사이클이 마무리되고 새로운 장이 열립니다.',
        '서로를 있는 그대로 받아들이는 깊은 이해가 생깁니다.',
        '함께 성장해 온 시간이 빛을 발합니다.',
        '관계의 균형이 잘 맞는 하루입니다.',
        '감사와 만족감이 관계를 풍요롭게 합니다.',
      ],
      doActions: [
        '함께 걸어온 시간에 감사를 표현하세요.',
        '서로의 성장을 인정하고 축하해 주세요.',
        '새로운 목표를 함께 세워보세요.',
        '관계의 긍정적인 면에 집중하세요.',
        '서로에게 배운 것을 나누어 보세요.',
        '작은 기념일이나 이벤트를 만들어 보세요.',
      ],
      dontActions: [
        '현재의 행복에 안주하여 노력을 멈추지 마세요.',
        '완벽한 관계라는 환상에 빠지지 마세요.',
        '성장의 과정에서 겪은 아픔을 되씹지 마세요.',
        '타인의 관계와 비교하지 마세요.',
        '현재에 만족한다고 소통을 게을리하지 마세요.',
        '새로운 도전을 두려워하지 마세요.',
      ],
    },
  ],

  money: [
    {
      title: '별',
      coreMessage: '재정적 희망이 보이는 긍정적인 하루입니다. 장기적 비전을 세우기에 좋은 날입니다.',
      details: [
        '새로운 수입원에 대한 아이디어가 떠오를 수 있습니다.',
        '투자나 저축에 대한 좋은 정보를 얻을 수 있습니다.',
        '긍정적인 마인드가 재정적 기회를 끌어당깁니다.',
        '미래를 위한 계획을 세우면 좋은 날입니다.',
        '작은 시작이 큰 성과로 이어질 수 있습니다.',
        '재정적 목표를 구체화하면 길이 보입니다.',
      ],
      doActions: [
        '장기 재정 목표를 종이에 적어보세요.',
        '관심 있던 투자 분야를 공부해 보세요.',
        '작은 금액이라도 저축을 시작하세요.',
        '재정 관련 좋은 습관을 하나 정해보세요.',
        '긍정적인 재정 마인드를 유지하세요.',
        '멘토나 전문가의 조언을 구해보세요.',
      ],
      dontActions: [
        '비현실적인 기대로 무리한 투자를 하지 마세요.',
        '로또나 도박에 의존하지 마세요.',
        '수익만 보고 리스크를 무시하지 마세요.',
        '충동적인 대출을 하지 마세요.',
        '남의 성공담에 휩쓸려 따라하지 마세요.',
        '재정 계획 없이 큰 지출을 하지 마세요.',
      ],
    },
    {
      title: '달',
      coreMessage: '숨겨진 재정적 기회를 발견할 수 있는 날입니다. 세심한 관찰력이 돈을 아끼고 벌게 합니다.',
      details: [
        '놓치고 있던 불필요한 지출을 발견할 수 있습니다.',
        '숨겨진 할인이나 혜택을 찾을 수 있습니다.',
        '직감이 재정적 판단에 도움을 줍니다.',
        '겉으로 보이는 것과 실제 가치가 다를 수 있습니다.',
        '조용히 준비하면 좋은 결과가 옵니다.',
        '세밀한 확인이 큰 손실을 막아줍니다.',
      ],
      doActions: [
        '은행 명세서와 구독 서비스를 점검하세요.',
        '할인 쿠폰이나 캐시백을 활용해 보세요.',
        '계약서의 세부 조항을 꼼꼼히 읽으세요.',
        '충동구매 전에 하루 생각해 보세요.',
        '가계부를 정리하여 패턴을 파악하세요.',
        '세금 공제 항목을 확인해 보세요.',
      ],
      dontActions: [
        '확인 없이 큰 결제를 하지 마세요.',
        '너무 좋은 조건의 제안을 무조건 믿지 마세요.',
        '재정 상황을 남에게 자세히 공개하지 마세요.',
        '밤에 쇼핑 충동에 넘어가지 마세요.',
        '검증되지 않은 재테크 정보를 맹신하지 마세요.',
        '불안감에 성급한 재정 결정을 하지 마세요.',
      ],
    },
    {
      title: '태양',
      coreMessage: '금전운이 밝게 빛나는 활기찬 하루입니다. 자신감을 가지고 재정 활동에 임하세요.',
      details: [
        '예상치 못한 보너스나 수입이 있을 수 있습니다.',
        '사업 아이디어가 주변의 호응을 얻습니다.',
        '재정적 결정에 명확한 판단력이 생깁니다.',
        '긍정적 에너지가 돈을 끌어당기는 날입니다.',
        '그동안의 노력이 경제적 보상으로 돌아옵니다.',
        '네트워킹이 재정적 기회로 이어질 수 있습니다.',
      ],
      doActions: [
        '적극적으로 기회를 잡으세요.',
        '사업 아이디어를 주변에 공유해 보세요.',
        '실력을 어필할 기회를 만들어 보세요.',
        '수입을 늘릴 부업이나 프로젝트를 탐색하세요.',
        '감사한 마음으로 기부나 나눔을 실천하세요.',
        '성과를 정리하여 인정받을 준비를 하세요.',
      ],
      dontActions: [
        '과시적인 소비를 하지 마세요.',
        '기분 좋다고 필요 없는 것을 사지 마세요.',
        '수입이 늘었다고 생활 수준을 급하게 올리지 마세요.',
        '성공에 도취되어 리스크 관리를 소홀히 하지 마세요.',
        '돈 자랑으로 주변의 시기를 사지 마세요.',
        '세금이나 의무를 잊지 마세요.',
      ],
    },
    {
      title: '탑',
      coreMessage: '재정 습관을 점검하고 새로 세울 때입니다. 예상 밖의 지출에 대비하세요.',
      details: [
        '갑작스러운 지출이 발생할 수 있으니 대비하세요.',
        '기존 재정 계획에 수정이 필요할 수 있습니다.',
        '위기 속에서 새로운 기회를 발견할 수 있습니다.',
        '불필요한 지출을 과감히 정리할 때입니다.',
        '변화가 불편하지만 장기적으로 이로울 수 있습니다.',
        '재정 구조를 다시 점검하면 안정감이 생깁니다.',
      ],
      doActions: [
        '비상금을 확인하고 보충하세요.',
        '불필요한 구독이나 서비스를 해지하세요.',
        '예산을 재조정해 보세요.',
        '보험이나 안전장치를 점검하세요.',
        '급한 지출에 대비한 계획을 세우세요.',
        '재정 전문가와 상담을 고려해 보세요.',
      ],
      dontActions: [
        '현실을 외면하고 소비를 계속하지 마세요.',
        '위기에 당황하여 패닉 셀링을 하지 마세요.',
        '빚으로 빚을 막으려 하지 마세요.',
        '화가 난다고 충동적인 큰 소비를 하지 마세요.',
        '문제를 미루며 악화시키지 마세요.',
        '남에게 재정적 부담을 떠넘기지 마세요.',
      ],
    },
    {
      title: '수레바퀴',
      coreMessage: '금전의 흐름에 변화가 찾아오는 날입니다. 새로운 사이클의 시작을 준비하세요.',
      details: [
        '수입원에 변화가 생길 수 있는 시기입니다.',
        '돈의 흐름이 바뀌는 전환점일 수 있습니다.',
        '순환의 법칙을 이해하면 마음이 편해집니다.',
        '지출 패턴을 바꾸면 새로운 가능성이 열립니다.',
        '기회는 준비된 사람에게 찾아옵니다.',
        '변화를 받아들이면 재정적 성장이 따릅니다.',
      ],
      doActions: [
        '수입과 지출 패턴을 분석해 보세요.',
        '새로운 재테크 방법을 탐색해 보세요.',
        '포트폴리오를 리밸런싱해 보세요.',
        '시장 흐름을 관찰하세요.',
        '유연한 재정 전략을 세우세요.',
        '다양한 수입원을 만들어 보세요.',
      ],
      dontActions: [
        '하나의 수입원에만 의존하지 마세요.',
        '과거의 성공 방식을 고집하지 마세요.',
        '유행에 따라 무작정 투자하지 마세요.',
        '변화를 무시하고 현상 유지만 하지 마세요.',
        '남의 재정 전략을 그대로 따라하지 마세요.',
        '단기 이익에 장기 안정을 희생하지 마세요.',
      ],
    },
    {
      title: '은둔자',
      coreMessage: '차분히 재정을 점검하면 좋은 결과가 있을 날입니다. 조용한 분석이 최고의 전략입니다.',
      details: [
        '혼자 조용히 재정 상태를 점검하기 좋은 날입니다.',
        '깊이 있는 분석이 현명한 결정으로 이어집니다.',
        '서두르지 않는 것이 최선의 전략입니다.',
        '다른 사람의 의견보다 자신의 판단을 믿으세요.',
        '장기적 관점으로 바라보면 답이 보입니다.',
        '절약과 검소한 생활이 빛을 발합니다.',
      ],
      doActions: [
        '가계부를 정리하고 분석하세요.',
        '장기 투자 계획을 검토해 보세요.',
        '재정 관련 책이나 자료를 공부하세요.',
        '과소비 습관이 있다면 원인을 찾아보세요.',
        '혼자만의 재정 점검 시간을 가지세요.',
        '미래를 위한 자기 투자를 계획하세요.',
      ],
      dontActions: [
        '주변 분위기에 휩쓸려 쇼핑하지 마세요.',
        '재정 결정을 남에게 떠맡기지 마세요.',
        '깊이 알아보지 않고 투자하지 마세요.',
        '귀찮다고 재정 관리를 미루지 마세요.',
        '소문만 듣고 투자 판단을 하지 마세요.',
        '인터넷 리뷰만 보고 큰 구매를 결정하지 마세요.',
      ],
    },
    {
      title: '힘',
      coreMessage: '꾸준한 노력이 재정적 성과로 이어지는 하루입니다. 인내가 곧 투자입니다.',
      details: [
        '지속적인 노력이 빛을 발하는 날입니다.',
        '어려움 속에서도 꾸준히 가면 성과가 옵니다.',
        '절약의 힘이 생각보다 크다는 것을 느낍니다.',
        '체력과 에너지가 곧 돈이 되는 날입니다.',
        '포기하지 않은 것이 최고의 투자였음을 깨닫습니다.',
        '실력을 쌓는 것이 가장 확실한 재테크입니다.',
      ],
      doActions: [
        '매일 조금씩 저축하는 습관을 실천하세요.',
        '업무 역량을 키우는 데 투자하세요.',
        '어렵더라도 계획된 예산을 지키세요.',
        '건강 관리도 재정 관리의 일부임을 기억하세요.',
        '장기 목표를 향해 작은 실천을 이어가세요.',
        '도전적인 프로젝트에 참여해 보세요.',
      ],
      dontActions: [
        '단기 수익에 현혹되어 방향을 바꾸지 마세요.',
        '성과가 안 보인다고 중도 포기하지 마세요.',
        '무리한 노동으로 건강을 해치지 마세요.',
        '한 번의 실패로 전체를 부정하지 마세요.',
        '완벽한 타이밍만 기다리며 행동하지 않는 것을 피하세요.',
        '힘든 시기에 사치로 보상하지 마세요.',
      ],
    },
    {
      title: '연인',
      coreMessage: '현명한 선택이 재정적 이득을 가져오는 날입니다. 가치 있는 곳에 돈을 쓰세요.',
      details: [
        '좋은 파트너십이 재정적 시너지를 만듭니다.',
        '가치 중심의 소비가 만족도를 높입니다.',
        '공동 투자나 협업에 좋은 기운이 있습니다.',
        '균형 잡힌 소비가 행복을 가져옵니다.',
        '사랑하는 사람과의 재정 대화가 필요합니다.',
        '돈보다 중요한 가치에 투자하면 좋은 날입니다.',
      ],
      doActions: [
        '가치 있는 경험에 투자해 보세요.',
        '파트너와 재정 목표를 함께 이야기하세요.',
        '협력할 수 있는 비즈니스 기회를 탐색하세요.',
        '가격 대비 가치가 좋은 물건을 선택하세요.',
        '관계를 위한 적절한 소비를 계획하세요.',
        '자기 성장을 위한 투자를 아끼지 마세요.',
      ],
      dontActions: [
        '감정적으로 큰 선물을 하지 마세요.',
        '관계를 돈으로만 유지하려 하지 마세요.',
        '동업 제안을 충분한 검토 없이 수락하지 마세요.',
        '체면 때문에 분수에 넘치는 소비를 하지 마세요.',
        '돈 문제로 갈등을 키우지 마세요.',
        '상대에게 재정적 의존도를 높이지 마세요.',
      ],
    },
    {
      title: '마법사',
      coreMessage: '창의적인 아이디어가 수익으로 연결될 수 있는 하루입니다. 능력을 활용하세요.',
      details: [
        '아이디어를 실행에 옮기면 수익이 생길 수 있습니다.',
        '기술과 능력이 곧 돈이 되는 날입니다.',
        '새로운 방법으로 문제를 해결하면 보상이 따릅니다.',
        '커뮤니케이션 능력이 비즈니스 기회를 만듭니다.',
        '다재다능함이 경제적 이점이 되는 날입니다.',
        '기존 자원을 창의적으로 활용하면 효율이 높아집니다.',
      ],
      doActions: [
        '사업 아이디어를 구체적으로 정리해 보세요.',
        '가진 능력으로 부수입을 만들어 보세요.',
        '협상이나 프레젠테이션에 적극적으로 임하세요.',
        '새로운 수익 모델을 실험해 보세요.',
        '네트워킹으로 기회를 넓혀보세요.',
        '디지털 도구를 활용해 효율을 높이세요.',
      ],
      dontActions: [
        '아이디어만 있고 실행하지 않으면 안 됩니다.',
        '사기성 있는 쉬운 돈벌이에 넘어가지 마세요.',
        '능력을 과대평가하여 무리하지 마세요.',
        '기본기 없이 트렌드만 쫓지 마세요.',
        '말만 잘한다고 실력이 증명되는 것은 아닙니다.',
        '초기 비용을 과소평가하지 마세요.',
      ],
    },
    {
      title: '황제',
      coreMessage: '체계적인 관리가 재정 안정을 가져오는 날입니다. 규율과 원칙이 돈을 지킵니다.',
      details: [
        '체계적인 예산 관리가 큰 효과를 발휘합니다.',
        '원칙을 지키면 재정적 안정이 유지됩니다.',
        '장기적 관점의 투자가 효과적인 날입니다.',
        '리더십이 팀이나 조직의 재정에 긍정적 영향을 줍니다.',
        '구조화된 접근이 복잡한 재정 문제를 해결합니다.',
        '신뢰할 수 있는 재정 시스템을 구축할 때입니다.',
      ],
      doActions: [
        '월별 예산을 체계적으로 세워보세요.',
        '자동이체로 저축 시스템을 만드세요.',
        '세금 관련 서류를 정리하세요.',
        '재정 목표를 달성하기 위한 로드맵을 그리세요.',
        '투자 원칙을 정하고 기록하세요.',
        '정기적인 재정 점검 날짜를 정하세요.',
      ],
      dontActions: [
        '융통성 없이 너무 엄격하게만 관리하지 마세요.',
        '모든 것을 혼자 결정하려 하지 마세요.',
        '숫자에만 집착하여 삶의 질을 무시하지 마세요.',
        '타인의 재정 상황을 통제하려 하지 마세요.',
        '규칙에 예외를 너무 많이 두지 마세요.',
        '자존심 때문에 도움을 구하기를 거부하지 마세요.',
      ],
    },
    {
      title: '여사제',
      coreMessage: '재정적 직감이 살아있는 날입니다. 내면의 소리에 귀 기울이되 검증은 잊지 마세요.',
      details: [
        '직감이 좋은 투자 기회를 알려줄 수 있습니다.',
        '보이지 않는 가치를 발견할 수 있는 날입니다.',
        '시장의 분위기를 읽는 감각이 예민해집니다.',
        '인내심이 재정적 보상을 가져옵니다.',
        '조용한 관찰이 최선의 투자 전략입니다.',
        '지식을 쌓는 것이 최고의 재테크입니다.',
      ],
      doActions: [
        '관심 있던 투자처를 깊이 분석해 보세요.',
        '재정 관련 교육이나 세미나를 들어보세요.',
        '시장 동향을 조용히 관찰하세요.',
        '직감과 데이터 분석을 함께 활용하세요.',
        '재정 관련 책을 한 권 읽어보세요.',
        '장기적 트렌드를 파악해 보세요.',
      ],
      dontActions: [
        '직감만 믿고 검증 없이 투자하지 마세요.',
        '남이 모른다는 비밀 투자 정보를 맹신하지 마세요.',
        '결과를 서두르며 조급해하지 마세요.',
        '분위기에 휩쓸려 대세를 따르지 마세요.',
        '자신의 분석 없이 전문가 말만 믿지 마세요.',
        '감추어진 리스크를 무시하지 마세요.',
      ],
    },
    {
      title: '세계',
      coreMessage: '재정적 목표에 한 걸음 더 가까워지는 하루입니다. 큰 그림을 보세요.',
      details: [
        '재정적 균형이 잘 맞는 날입니다.',
        '글로벌한 시야가 새로운 기회를 열어줍니다.',
        '그동안의 재정 관리가 성과를 보입니다.',
        '다양한 분야의 포트폴리오가 안정감을 줍니다.',
        '하나의 목표를 달성하고 다음을 준비할 때입니다.',
        '감사하는 마음이 풍요를 유지시킵니다.',
      ],
      doActions: [
        '달성한 재정 목표를 기록하고 축하하세요.',
        '다음 단계의 목표를 설정하세요.',
        '해외 투자나 글로벌 기회를 탐색해 보세요.',
        '전체 자산을 균형 있게 점검하세요.',
        '지식과 경험을 다른 사람과 나누세요.',
        '새로운 도전에 적절한 투자를 시작하세요.',
      ],
      dontActions: [
        '목표를 달성했다고 관리를 소홀히 하지 마세요.',
        '안전지대에만 머무르지 마세요.',
        '풍요로운 시기에 낭비하지 마세요.',
        '한 분야에만 모든 자금을 집중하지 마세요.',
        '현재의 성과에 자만하지 마세요.',
        '장기적 비전 없이 단기 수익만 쫓지 마세요.',
      ],
    },
  ],

  health: [
    {
      title: '별',
      coreMessage: '몸과 마음에 활력이 넘치는 긍정적인 하루입니다. 건강한 에너지로 하루를 시작하세요.',
      details: [
        '전반적으로 컨디션이 좋은 날입니다.',
        '긍정적인 마인드가 면역력을 높여줍니다.',
        '새로운 건강 습관을 시작하기 좋은 날입니다.',
        '자연 속에서 힐링 에너지를 받으세요.',
        '좋은 기운이 몸을 감싸는 날입니다.',
        '감사하는 마음이 건강에 긍정적 영향을 줍니다.',
      ],
      doActions: [
        '아침에 가벼운 스트레칭으로 시작하세요.',
        '신선한 과일이나 채소를 많이 섭취하세요.',
        '야외에서 햇빛을 쬐며 산책하세요.',
        '감사 일기를 쓰며 긍정 에너지를 채우세요.',
        '물을 충분히 마시세요.',
        '좋아하는 운동을 즐겨보세요.',
      ],
      dontActions: [
        '좋은 컨디션을 믿고 무리하지 마세요.',
        '건강을 과신해 끼니를 거르지 마세요.',
        '밤늦게까지 활동하지 마세요.',
        '카페인을 과도하게 섭취하지 마세요.',
        '좋다고 운동을 무리하게 하지 마세요.',
        '디지털 기기 사용을 과하게 하지 마세요.',
      ],
    },
    {
      title: '달',
      coreMessage: '내면의 평화가 건강의 열쇠가 되는 날입니다. 정서적 안정에 집중하세요.',
      details: [
        '감정이 신체에 영향을 줄 수 있는 날입니다.',
        '스트레스 관리가 특히 중요합니다.',
        '충분한 수면이 회복의 핵심입니다.',
        '마음의 안정이 면역력을 높여줍니다.',
        '호흡에 집중하면 긴장이 풀립니다.',
        '몸이 보내는 미세한 신호에 주의를 기울이세요.',
      ],
      doActions: [
        '취침 전 명상이나 호흡 운동을 해보세요.',
        '따뜻한 차를 마시며 릴렉스 타임을 가지세요.',
        '감정을 일기에 적어 스트레스를 해소하세요.',
        '아로마 테라피나 목욕으로 긴장을 풀어보세요.',
        '평소보다 30분 일찍 잠자리에 들어보세요.',
        '조용한 음악을 들으며 휴식하세요.',
      ],
      dontActions: [
        '밤늦게 강한 빛에 노출되지 마세요.',
        '자기 전 카페인이나 알코올을 피하세요.',
        '걱정을 반복적으로 되새기지 마세요.',
        '수면 부족을 가볍게 여기지 마세요.',
        '부정적인 뉴스를 과도하게 소비하지 마세요.',
        '감정을 억누르고 참기만 하지 마세요.',
      ],
    },
    {
      title: '태양',
      coreMessage: '에너지가 넘치고 활기찬 컨디션의 하루입니다. 활동적인 하루를 즐기세요.',
      details: [
        '체력이 좋아 다양한 활동이 가능합니다.',
        '야외 활동에 좋은 에너지가 흐릅니다.',
        '비타민 D 충전에 좋은 날입니다.',
        '운동 효과가 극대화되는 날입니다.',
        '밝은 기분이 신체 활력으로 이어집니다.',
        '사회적 활동이 정신 건강에 도움이 됩니다.',
      ],
      doActions: [
        '30분 이상 유산소 운동을 해보세요.',
        '밖에 나가 햇빛을 충분히 쬐세요.',
        '친구와 함께 운동하며 즐거운 시간을 보내세요.',
        '에너지가 높을 때 밀린 집안일을 해결하세요.',
        '영양 균형 잡힌 식사를 하세요.',
        '하루 8잔 이상의 물을 마시세요.',
      ],
      dontActions: [
        '에너지가 좋다고 무리한 운동을 하지 마세요.',
        '자외선 차단을 소홀히 하지 마세요.',
        '너무 더운 시간에 야외 운동을 하지 마세요.',
        '식사를 걸러가며 활동하지 마세요.',
        '수분 보충을 게을리하지 마세요.',
        '과도한 활동으로 수면 시간을 줄이지 마세요.',
      ],
    },
    {
      title: '탑',
      coreMessage: '생활 습관을 점검하고 새롭게 시작할 때입니다. 작은 변화가 건강을 지켜줍니다.',
      details: [
        '건강 신호를 무시하지 말고 점검이 필요합니다.',
        '나쁜 습관을 과감히 끊을 수 있는 에너지가 있습니다.',
        '생활 리듬을 바로잡으면 컨디션이 나아집니다.',
        '미루던 건강 검진을 예약할 때입니다.',
        '몸이 보내는 경고를 진지하게 받아들이세요.',
        '변화가 처음엔 힘들지만 결과는 긍정적입니다.',
      ],
      doActions: [
        '미루던 건강 검진을 예약하세요.',
        '나쁜 습관 하나를 오늘부터 줄여보세요.',
        '자세를 교정하는 습관을 시작하세요.',
        '식습관을 점검하고 개선점을 찾으세요.',
        '알레르기나 불편한 증상을 기록해 보세요.',
        '응급 상비약을 확인하고 보충하세요.',
      ],
      dontActions: [
        '몸이 보내는 이상 신호를 무시하지 마세요.',
        '통증을 진통제로만 해결하려 하지 마세요.',
        '건강 검진을 계속 미루지 마세요.',
        '인터넷으로 자가 진단하지 마세요.',
        '무리한 다이어트를 시작하지 마세요.',
        '수면 패턴이 망가지게 놔두지 마세요.',
      ],
    },
    {
      title: '수레바퀴',
      coreMessage: '건강 리듬에 변화를 주면 좋은 결과가 있을 날입니다. 새로운 루틴을 시도해 보세요.',
      details: [
        '운동 루틴을 바꾸면 새로운 효과가 생깁니다.',
        '식단에 변화를 주면 몸이 좋아집니다.',
        '계절 변화에 맞는 건강 관리가 필요합니다.',
        '몸의 사이클을 이해하면 건강 관리가 쉬워집니다.',
        '새로운 건강 습관이 빠르게 자리 잡을 수 있습니다.',
        '변화를 주되 무리하지 않는 것이 핵심입니다.',
      ],
      doActions: [
        '평소와 다른 운동을 시도해 보세요.',
        '새로운 건강 레시피에 도전해 보세요.',
        '출퇴근 경로를 바꿔 걸어보세요.',
        '잠자는 시간을 조금 앞당겨 보세요.',
        '스트레칭이나 요가를 일과에 추가하세요.',
        '간식을 건강한 것으로 바꿔보세요.',
      ],
      dontActions: [
        '갑자기 과격한 운동을 시작하지 마세요.',
        '극단적인 식단 변화를 하지 마세요.',
        '검증 안 된 건강 유행을 따르지 마세요.',
        '변화를 너무 많이 한꺼번에 시도하지 마세요.',
        '몸의 적응 시간을 무시하지 마세요.',
        '새로운 것이 항상 좋다고 단정하지 마세요.',
      ],
    },
    {
      title: '은둔자',
      coreMessage: '충분한 휴식이 최고의 보약이 되는 하루입니다. 몸과 마음을 쉬게 해주세요.',
      details: [
        '오늘은 무리하지 않는 것이 최선입니다.',
        '조용한 휴식이 몸의 회복력을 높여줍니다.',
        '혼자만의 편안한 시간이 에너지를 충전시킵니다.',
        '디지털 디톡스를 고려해 보면 좋은 날입니다.',
        '수면의 질에 특히 신경 쓰면 좋습니다.',
        '명상이 마음과 몸을 동시에 치유합니다.',
      ],
      doActions: [
        '낮잠을 15~20분 정도 자보세요.',
        '디지털 기기 사용을 줄이고 쉬세요.',
        '따뜻한 물로 반신욕을 해보세요.',
        '가벼운 독서로 마음을 편안히 하세요.',
        '좋아하는 음악을 들으며 릴렉스하세요.',
        '편안한 옷을 입고 하루를 보내세요.',
      ],
      dontActions: [
        '피로한 상태에서 억지로 활동하지 마세요.',
        '수면 시간을 줄이지 마세요.',
        '카페인으로 피로를 이기려 하지 마세요.',
        '아픈 몸으로 출근이나 약속을 강행하지 마세요.',
        '밤새 스마트폰을 보지 마세요.',
        '에너지 드링크에 의존하지 마세요.',
      ],
    },
    {
      title: '힘',
      coreMessage: '체력과 정신력 모두 강해지는 날입니다. 한계에 도전해 보세요.',
      details: [
        '운동 강도를 한 단계 올려볼 만한 날입니다.',
        '체력이 좋아 어려운 활동도 해낼 수 있습니다.',
        '정신적 강인함이 신체적 건강으로 이어집니다.',
        '도전적인 목표를 세우면 달성할 수 있는 에너지가 있습니다.',
        '자기 관리에 대한 의지력이 높은 날입니다.',
        '근력 운동이 특히 효과적인 날입니다.',
      ],
      doActions: [
        '근력 운동으로 근육을 키워보세요.',
        '평소보다 운동 강도를 높여보세요.',
        '단백질이 풍부한 식사를 하세요.',
        '체력 목표를 설정하고 기록을 시작하세요.',
        '계단 오르기 등 일상 속 운동을 실천하세요.',
        '바른 자세를 유지하며 생활하세요.',
      ],
      dontActions: [
        '워밍업 없이 강한 운동을 하지 마세요.',
        '통증을 참으며 운동을 계속하지 마세요.',
        '수분 보충을 잊지 마세요.',
        '과도한 운동 후 스트레칭을 빼먹지 마세요.',
        '한 번에 너무 높은 목표를 세우지 마세요.',
        '회복 시간을 무시하고 매일 강도 높은 운동을 하지 마세요.',
      ],
    },
    {
      title: '연인',
      coreMessage: '마음의 안정이 몸의 건강으로 이어지는 날입니다. 소중한 사람과 함께하는 시간이 치유입니다.',
      details: [
        '사회적 연결이 정신 건강에 긍정적입니다.',
        '사랑하는 사람과의 시간이 스트레스를 줄여줍니다.',
        '감정적 안정이 면역력을 높여줍니다.',
        '대화와 공감이 마음의 건강에 도움을 줍니다.',
        '함께하는 활동이 건강에 시너지를 만듭니다.',
        '웃음이 최고의 약이 되는 날입니다.',
      ],
      doActions: [
        '소중한 사람과 함께 산책하세요.',
        '맛있고 건강한 식사를 함께 준비하세요.',
        '진심 어린 대화로 마음을 나누세요.',
        '함께 웃을 수 있는 활동을 해보세요.',
        '파트너와 함께 운동해 보세요.',
        '감사의 마음을 표현하세요.',
      ],
      dontActions: [
        '갈등으로 스트레스를 받으며 하루를 보내지 마세요.',
        '감정을 억눌러 두통이나 긴장을 유발하지 마세요.',
        '사람들 앞에서 무리하게 괜찮은 척하지 마세요.',
        '관계 스트레스를 음식이나 술로 풀지 마세요.',
        '혼자 아프다며 도움을 거부하지 마세요.',
        '감정적 소진을 무시하지 마세요.',
      ],
    },
    {
      title: '마법사',
      coreMessage: '새로운 건강 습관을 시작하기 좋은 하루입니다. 작은 변화가 큰 차이를 만듭니다.',
      details: [
        '건강 앱이나 도구를 활용하면 효과적입니다.',
        '새로운 건강 정보를 학습하기 좋은 날입니다.',
        '창의적인 운동 방법이 동기를 부여합니다.',
        '기술을 활용한 건강 관리가 효과적입니다.',
        '작은 시작이 큰 건강 변화를 만들 수 있습니다.',
        '자신만의 건강 루틴을 만들어 보세요.',
      ],
      doActions: [
        '건강 관리 앱을 설치해 보세요.',
        '새로운 운동 영상을 따라 해보세요.',
        '건강 레시피를 검색해서 만들어 보세요.',
        '하루 만보 걷기를 시도해 보세요.',
        '식단 기록을 시작해 보세요.',
        '명상 앱으로 마음 챙김을 연습하세요.',
      ],
      dontActions: [
        '검증되지 않은 건강 보조제를 복용하지 마세요.',
        '인터넷 건강 정보를 무분별하게 따르지 마세요.',
        '시작만 하고 꾸준히 하지 않으면 효과가 없습니다.',
        '너무 많은 것을 한꺼번에 바꾸려 하지 마세요.',
        '다른 사람의 루틴을 그대로 따라하지 마세요.',
        '즉각적인 효과만 기대하지 마세요.',
      ],
    },
    {
      title: '황제',
      coreMessage: '규칙적인 생활이 건강을 지켜주는 날입니다. 일정한 리듬으로 하루를 보내세요.',
      details: [
        '정해진 시간에 식사하면 소화가 좋아집니다.',
        '일정한 수면 패턴이 컨디션을 높여줍니다.',
        '계획된 운동이 효과가 더 좋습니다.',
        '자기 규율이 건강의 기본입니다.',
        '루틴의 힘이 장기적 건강을 만듭니다.',
        '체계적인 건강 관리가 빛을 발하는 날입니다.',
      ],
      doActions: [
        '매일 같은 시간에 기상하고 취침하세요.',
        '식사 시간을 규칙적으로 유지하세요.',
        '주간 운동 스케줄을 만들어 보세요.',
        '하루 일과를 미리 계획하세요.',
        '건강 목표를 구체적으로 적어보세요.',
        '체크리스트로 건강 습관을 관리하세요.',
      ],
      dontActions: [
        '불규칙한 식사 시간을 방치하지 마세요.',
        '주말에 수면 패턴을 완전히 깨지 마세요.',
        '운동을 기분에 따라서만 하지 마세요.',
        '야식을 습관적으로 먹지 마세요.',
        '알람을 끄고 늦잠을 자지 마세요.',
        '건강 루틴을 자주 바꾸지 마세요.',
      ],
    },
    {
      title: '여사제',
      coreMessage: '몸이 보내는 신호에 귀 기울이면 좋은 날입니다. 내 몸의 목소리를 들어보세요.',
      details: [
        '평소와 다른 몸의 변화를 감지할 수 있습니다.',
        '직감적으로 필요한 영양소를 알 수 있습니다.',
        '내 몸에 맞는 건강법을 찾는 것이 중요합니다.',
        '명상과 호흡법이 특히 효과적인 날입니다.',
        '과거의 건강 패턴을 되돌아보면 통찰이 생깁니다.',
        '조용한 환경에서 몸의 소리를 들어보세요.',
      ],
      doActions: [
        '몸이 원하는 음식을 적절히 섭취하세요.',
        '5분 호흡 명상을 실천해 보세요.',
        '몸의 변화를 건강 일지에 기록하세요.',
        '컨디션이 안 좋으면 쉬어가세요.',
        '건강 검진 결과를 꼼꼼히 확인하세요.',
        '몸에 좋은 허브차를 마셔보세요.',
      ],
      dontActions: [
        '몸의 경고 신호를 무시하지 마세요.',
        '남들이 좋다는 건강법을 무조건 따르지 마세요.',
        '통증을 약으로만 해결하려 하지 마세요.',
        '건강 염려증에 빠지지 마세요.',
        '자가 처방을 하지 마세요.',
        '증상을 인터넷 검색으로만 진단하지 마세요.',
      ],
    },
    {
      title: '세계',
      coreMessage: '전반적인 건강 밸런스가 좋은 하루입니다. 몸과 마음의 조화를 즐기세요.',
      details: [
        '심신의 균형이 잘 맞는 날입니다.',
        '전체적인 컨디션이 양호합니다.',
        '건강한 상태를 유지하는 것이 중요합니다.',
        '다양한 활동을 균형 있게 즐길 수 있습니다.',
        '건강 목표를 달성한 것에 스스로를 칭찬하세요.',
        '좋은 상태를 유지하기 위한 관리가 필요합니다.',
      ],
      doActions: [
        '균형 잡힌 식사를 세 끼 챙기세요.',
        '유산소와 무산소 운동을 균형있게 하세요.',
        '일과 휴식의 밸런스를 유지하세요.',
        '건강 목표를 점검하고 달성을 축하하세요.',
        '전체적인 건강 상태를 기록해 보세요.',
        '좋아하는 활동으로 에너지를 충전하세요.',
      ],
      dontActions: [
        '한 분야에만 치중한 건강 관리를 하지 마세요.',
        '좋은 컨디션을 당연시하지 마세요.',
        '균형 잡힌 생활을 무너뜨리는 행동을 하지 마세요.',
        '과로나 과음으로 좋은 상태를 망치지 마세요.',
        '건강 관리를 중단하지 마세요.',
        '지금의 좋은 상태가 관리 없이도 유지된다고 생각하지 마세요.',
      ],
    },
  ],
};

/* ─────────────────────────────────────
   3. State Management
   ───────────────────────────────────── */

const STORAGE_KEY = 'tarot_state';

/** Default empty state */
function defaultState() {
  return {
    deviceId: '',
    date: '',
    loveId: -1,
    moneyId: -1,
    healthId: -1,
    drawCount: 0,
    revealed: false,
  };
}

/** Load state from localStorage (returns default if not found) */
function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return defaultState();
    return JSON.parse(raw);
  } catch {
    return defaultState();
  }
}

/** Save state to localStorage */
function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/** Get or create deviceId */
function ensureDeviceId(state) {
  if (!state.deviceId) {
    state.deviceId =
      typeof crypto !== 'undefined' && crypto.randomUUID
        ? crypto.randomUUID()
        : 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            const r = (Math.random() * 16) | 0;
            return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);
          });
  }
  return state;
}

/** Create PRNG from date + deviceId + optional extra seed */
function createRng(date, deviceId, extra) {
  const seed = hashString(date + ':' + deviceId + (extra ? ':' + extra : ''));
  return mulberry32(seed & 0xffffffff);
}

/** Pick a base result ID (0-11) for a given category using PRNG */
function pickBaseId(rng) {
  return Math.floor(rng() * 12);
}

/** Pick detail/do/dont indices based on drawCount */
function pickVariants(rng, drawCount, arrayLen, count) {
  // Advance RNG by drawCount to get variation
  for (let i = 0; i < drawCount * 3; i++) rng();
  const indices = [];
  const used = new Set();
  while (indices.length < count && indices.length < arrayLen) {
    const idx = Math.floor(rng() * arrayLen);
    if (!used.has(idx)) {
      used.add(idx);
      indices.push(idx);
    }
  }
  return indices;
}

/* ─────────────────────────────────────
   4. Share Link Logic (base64url)
   ───────────────────────────────────── */

/** Encode payload to base64url */
function encodePayload(obj) {
  const json = JSON.stringify(obj);
  // TextEncoder → Uint8Array → base64 → base64url
  const bytes = new TextEncoder().encode(json);
  let binary = '';
  for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
  return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
}

/** Decode base64url → payload object */
function decodePayload(str) {
  try {
    const b64 = str.replace(/-/g, '+').replace(/_/g, '/');
    const binary = atob(b64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
    const json = new TextDecoder().decode(bytes);
    return JSON.parse(json);
  } catch {
    return null;
  }
}

/** Read ?share= param from URL */
function getShareParam() {
  const params = new URLSearchParams(window.location.search);
  return params.get('share') || null;
}

/** Remove ?share= from URL without reload */
function clearShareParam() {
  const url = new URL(window.location);
  url.searchParams.delete('share');
  window.history.replaceState({}, '', url.toString());
}

/* ─────────────────────────────────────
   5. UI Rendering
   ───────────────────────────────────── */

const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => document.querySelectorAll(sel);

/** Render card fronts with archetype info */
function renderCardFronts(loveId, moneyId, healthId) {
  const love = TAROT.love[loveId];
  const money = TAROT.money[moneyId];
  const health = TAROT.health[healthId];

  $('#card-front-love .card__front-symbol').textContent = ARCHETYPES[loveId].symbol;
  $('#card-front-love .card__front-title').textContent = love.title;

  $('#card-front-money .card__front-symbol').textContent = ARCHETYPES[moneyId].symbol;
  $('#card-front-money .card__front-title').textContent = money.title;

  $('#card-front-health .card__front-symbol').textContent = ARCHETYPES[healthId].symbol;
  $('#card-front-health .card__front-title').textContent = health.title;
}

/** Render one category result */
function renderCategory(category, data, drawCount, dateStr, deviceId) {
  const rng = createRng(dateStr, deviceId, category + ':' + drawCount);

  const detailIndices = pickVariants(rng, drawCount, data.details.length, 2);
  const doIdx = pickVariants(rng, drawCount, data.doActions.length, 1);
  const dontIdx = pickVariants(rng, drawCount, data.dontActions.length, 1);

  $(`#core-${category}`).textContent = data.coreMessage;

  const detailsEl = $(`#details-${category}`);
  detailsEl.innerHTML = '';
  detailIndices.forEach((i) => {
    const p = document.createElement('p');
    p.textContent = data.details[i];
    detailsEl.appendChild(p);
  });

  $(`#do-${category}`).textContent = data.doActions[doIdx[0]];
  $(`#dont-${category}`).textContent = data.dontActions[dontIdx[0]];
}

/** Render recommendations based on card results */
function renderRecommendations(loveId, moneyId, healthId, drawCount) {
  const container = $('#affiliate-cards');
  if (!container) return;
  container.innerHTML = '';

  // 각 카테고리의 아키타입에서 1개씩 추천 (drawCount로 인덱스 변동)
  const picks = [
    { archId: loveId, label: '연애' },
    { archId: moneyId, label: '금전' },
    { archId: healthId, label: '건강' },
  ];

  picks.forEach(({ archId, label }) => {
    const pool = RECOMMENDATIONS[archId];
    const idx = drawCount % pool.length;
    const rec = pool[idx];

    const a = document.createElement('a');
    a.href = '#';
    a.className = 'affiliate__card';
    a.setAttribute('aria-label', rec.name);
    a.innerHTML = `
      <div class="affiliate__thumb">${rec.emoji}</div>
      <span class="affiliate__name">${rec.name}</span>
      <span class="affiliate__desc">${rec.desc}</span>
      <span class="affiliate__tag">${rec.tag} · ${label}운 기반</span>
    `;
    // 제휴 링크 연동 시 href를 실제 URL로 교체
    a.addEventListener('click', (e) => e.preventDefault());
    container.appendChild(a);
  });
}

/** Render all results */
function renderResults(state, isShareMode) {
  const dateStr = isShareMode ? state.date : getTodayStr();
  const deviceId = isShareMode ? 'shared' : state.deviceId;

  renderCardFronts(state.loveId, state.moneyId, state.healthId);

  renderCategory('love', TAROT.love[state.loveId], state.drawCount, dateStr, deviceId);
  renderCategory('money', TAROT.money[state.moneyId], state.drawCount, dateStr, deviceId);
  renderCategory('health', TAROT.health[state.healthId], state.drawCount, dateStr, deviceId);

  // 카드 결과 기반 추천 콘텐츠 렌더링
  renderRecommendations(state.loveId, state.moneyId, state.healthId, state.drawCount);
}

/** Show toast message */
function showToast(msg) {
  const toast = $('#toast');
  toast.textContent = msg || '링크가 클립보드에 복사되었습니다!';
  toast.hidden = false;
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => {
    toast.hidden = true;
  }, 2500);
}

/** Flip cards with stagger */
function flipCards(callback) {
  const cards = $$('.card');
  cards.forEach((card, i) => {
    setTimeout(() => {
      card.classList.add('flipped');
      if (i === cards.length - 1 && callback) {
        setTimeout(callback, 400);
      }
    }, i * 250);
  });
}

/** Reset card flip */
function resetCards() {
  $$('.card').forEach((card) => card.classList.remove('flipped'));
}

/* ─────────────────────────────────────
   6. App Logic & Event Handlers
   ───────────────────────────────────── */

let appState = defaultState();
let isShareMode = false;
let sharePayload = null;

function initApp() {
  // 1. Check for share link
  const shareParam = getShareParam();
  if (shareParam) {
    sharePayload = decodePayload(shareParam);
  }

  if (sharePayload && typeof sharePayload.l === 'number') {
    // Share mode
    isShareMode = true;
    appState = {
      deviceId: 'shared',
      date: sharePayload.d || getTodayStr(),
      loveId: sharePayload.l % 12,
      moneyId: sharePayload.m % 12,
      healthId: sharePayload.h % 12,
      drawCount: sharePayload.n || 0,
      revealed: true,
    };

    // Show share badge
    $('#share-badge').hidden = false;

    // Render immediately
    renderResults(appState, true);
    flipCards(() => {
      $('#results').hidden = false;
    });

    // Disable draw button in share mode
    $('#btn-draw').disabled = true;
    $('#btn-draw').textContent = '공유 결과 보기 중';

    // Hide redraw in share mode
    $('#btn-redraw').style.display = 'none';
  } else {
    // Normal mode
    isShareMode = false;
    appState = loadState();
    ensureDeviceId(appState);

    const today = getTodayStr();

    // Date change detection
    if (appState.date !== today) {
      const rng = createRng(today, appState.deviceId);
      appState.date = today;
      appState.loveId = pickBaseId(rng);
      appState.moneyId = pickBaseId(rng);
      appState.healthId = pickBaseId(rng);
      appState.drawCount = 0;
      appState.revealed = false;
    }

    saveState(appState);

    // If already revealed today, restore
    if (appState.revealed) {
      renderResults(appState, false);
      flipCards(() => {
        $('#results').hidden = false;
      });
      $('#btn-draw').disabled = true;
      $('#btn-draw').textContent = '✨ 오늘의 카드 확인 완료';
    }
  }
}

/** Handle draw button */
function handleDraw() {
  if (isShareMode) return;

  const today = getTodayStr();

  // Ensure base IDs exist (first draw of the day)
  if (!appState.revealed) {
    if (appState.date !== today) {
      const rng = createRng(today, appState.deviceId);
      appState.date = today;
      appState.loveId = pickBaseId(rng);
      appState.moneyId = pickBaseId(rng);
      appState.healthId = pickBaseId(rng);
      appState.drawCount = 0;
    }
    appState.revealed = true;
  }

  renderResults(appState, false);
  saveState(appState);

  // Flip animation
  flipCards(() => {
    $('#results').hidden = false;
    $('#results').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  $('#btn-draw').disabled = true;
  $('#btn-draw').textContent = '✨ 오늘의 카드 확인 완료';
}

/** Handle redraw */
function handleRedraw() {
  if (isShareMode) return;

  appState.drawCount += 1;
  saveState(appState);

  // Reset and re-flip
  resetCards();
  $('#results').hidden = true;

  setTimeout(() => {
    renderResults(appState, false);
    flipCards(() => {
      $('#results').hidden = false;
      $('#results').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  }, 500);
}

/** Handle share */
function handleShare() {
  const payload = {
    d: appState.date,
    l: appState.loveId,
    m: appState.moneyId,
    h: appState.healthId,
    n: appState.drawCount,
  };

  const encoded = encodePayload(payload);
  const url = window.location.origin + window.location.pathname + '?share=' + encoded;

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(url).then(
      () => showToast(),
      () => fallbackCopy(url)
    );
  } else {
    fallbackCopy(url);
  }
}

/** Fallback copy for older browsers */
function fallbackCopy(text) {
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText = 'position:fixed;left:-9999px';
  document.body.appendChild(ta);
  ta.select();
  try {
    document.execCommand('copy');
    showToast();
  } catch {
    showToast('링크를 복사하지 못했습니다. 직접 복사해 주세요.');
  }
  document.body.removeChild(ta);
}

/** Handle "내 운세 보기" (exit share mode) */
function handleMyFortune() {
  clearShareParam();
  isShareMode = false;
  sharePayload = null;
  $('#share-badge').hidden = true;
  $('#btn-redraw').style.display = '';

  // Reload own state
  appState = loadState();
  ensureDeviceId(appState);
  const today = getTodayStr();
  if (appState.date !== today) {
    const rng = createRng(today, appState.deviceId);
    appState.date = today;
    appState.loveId = pickBaseId(rng);
    appState.moneyId = pickBaseId(rng);
    appState.healthId = pickBaseId(rng);
    appState.drawCount = 0;
    appState.revealed = false;
  }
  saveState(appState);

  resetCards();
  $('#results').hidden = true;

  if (appState.revealed) {
    renderResults(appState, false);
    flipCards(() => {
      $('#results').hidden = false;
    });
    $('#btn-draw').disabled = true;
    $('#btn-draw').textContent = '✨ 오늘의 카드 확인 완료';
  } else {
    $('#btn-draw').disabled = false;
    $('#btn-draw').textContent = '🃏 카드 뽑기';
  }
}

/* ─────────────────────────────────────
   7. Tab Navigation
   ───────────────────────────────────── */

let currentTab = 'fortune';

function switchTab(tabId) {
  if (currentTab === tabId) return;
  currentTab = tabId;

  // Update buttons
  $$('.tab-bar__btn').forEach((btn) => {
    btn.classList.toggle('tab-bar__btn--active', btn.dataset.tab === tabId);
  });

  // Update panels
  $$('.tab-panel').forEach((panel) => {
    panel.hidden = panel.id !== 'tab-' + tabId;
  });

  // Lazy render gallery / report
  if (tabId === 'gallery') renderGallery();
  if (tabId === 'report') renderReport();

  // Scroll to top of main
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ─────────────────────────────────────
   8. Card Gallery (카드 도감)
   ───────────────────────────────────── */

let galleryRendered = false;

function renderGallery() {
  if (galleryRendered) return;
  galleryRendered = true;

  const grid = $('#gallery-grid');
  grid.innerHTML = '';

  ARCHETYPES.forEach((arch, idx) => {
    const item = document.createElement('button');
    item.className = 'gallery-item';
    item.setAttribute('aria-label', arch.name + ' 카드 상세 보기');
    item.innerHTML = `
      <span class="gallery-item__symbol">${arch.symbol}</span>
      <span class="gallery-item__name">${arch.name}</span>
      <span class="gallery-item__index">${idx + 1} / 12</span>
    `;
    item.addEventListener('click', () => openGalleryModal(idx));
    grid.appendChild(item);
  });
}

function openGalleryModal(idx) {
  const arch = ARCHETYPES[idx];
  const modal = $('#gallery-modal');

  $('#modal-symbol').textContent = arch.symbol;
  $('#modal-title').textContent = arch.name;

  const body = $('#modal-body');
  body.innerHTML = '';

  const categories = [
    { key: 'love', label: '💕 연애운', cssClass: 'love' },
    { key: 'money', label: '💰 금전운', cssClass: 'money' },
    { key: 'health', label: '💚 건강운', cssClass: 'health' },
  ];

  categories.forEach(({ key, label, cssClass }) => {
    const data = TAROT[key][idx];
    const div = document.createElement('div');
    div.className = `modal-category modal-category--${cssClass}`;
    div.innerHTML = `
      <h4 class="modal-category__title">${label}</h4>
      <p class="modal-category__core">${data.coreMessage}</p>
    `;
    body.appendChild(div);
  });

  modal.hidden = false;
  document.body.style.overflow = 'hidden';
}

function closeGalleryModal() {
  $('#gallery-modal').hidden = true;
  document.body.style.overflow = '';
}

/* ─────────────────────────────────────
   9. Detailed Report (심화 리포트)
   ───────────────────────────────────── */

function renderReport() {
  const empty = $('#report-empty');
  const content = $('#report-content');

  if (!appState.revealed) {
    empty.hidden = false;
    content.hidden = true;
    return;
  }

  empty.hidden = true;
  content.hidden = false;

  const dateStr = isShareMode ? appState.date : getTodayStr();
  const deviceId = isShareMode ? 'shared' : appState.deviceId;

  // Combo cards
  const comboCards = $('#report-combo-cards');
  comboCards.innerHTML = '';
  const cardInfos = [
    { id: appState.loveId, cat: '연애', cssClass: 'love' },
    { id: appState.moneyId, cat: '금전', cssClass: 'money' },
    { id: appState.healthId, cat: '건강', cssClass: 'health' },
  ];
  cardInfos.forEach(({ id, cat, cssClass }) => {
    const div = document.createElement('div');
    div.className = `report-combo-card report-combo-card--${cssClass}`;
    div.innerHTML = `
      <span class="report-combo-card__symbol">${ARCHETYPES[id].symbol}</span>
      <span class="report-combo-card__name">${ARCHETYPES[id].name}</span>
      <span class="report-combo-card__cat">${cat}</span>
    `;
    comboCards.appendChild(div);
  });

  // Combo message
  const comboSeed = hashString(dateStr + ':' + appState.loveId + ':' + appState.moneyId + ':' + appState.healthId);
  const comboIdx = Math.abs(comboSeed) % COMBO_MESSAGES.length;
  $('#report-combo-msg').textContent = COMBO_MESSAGES[comboIdx];

  // Lucky grid
  const luckyGrid = $('#report-lucky-grid');
  luckyGrid.innerHTML = '';
  // Pick lucky data based on dominant card (love card as primary)
  const lucky = LUCKY_DATA[appState.loveId];
  const luckyItems = [
    { icon: '🎨', label: '행운의 색', value: lucky.color },
    { icon: '🔢', label: '행운의 숫자', value: lucky.number },
    { icon: '🧭', label: '행운의 방향', value: lucky.direction },
    { icon: '⏰', label: '행운의 시간', value: lucky.time },
  ];
  luckyItems.forEach(({ icon, label, value }) => {
    const div = document.createElement('div');
    div.className = 'lucky-item';
    div.innerHTML = `
      <span class="lucky-item__icon">${icon}</span>
      <span class="lucky-item__label">${label}</span>
      <span class="lucky-item__value">${value}</span>
    `;
    luckyGrid.appendChild(div);
  });

  // Detailed analysis per category
  const categories = [
    { key: 'love', id: appState.loveId },
    { key: 'money', id: appState.moneyId },
    { key: 'health', id: appState.healthId },
  ];

  categories.forEach(({ key, id }) => {
    const data = TAROT[key][id];
    const body = $(`#report-${key}-body`);
    body.innerHTML = '';

    // Core message
    const core = document.createElement('p');
    core.className = 'report-core';
    core.textContent = data.coreMessage;
    body.appendChild(core);

    // All details
    const detailTitle = document.createElement('h4');
    detailTitle.textContent = '세부 해석';
    body.appendChild(detailTitle);
    const detailUl = document.createElement('ul');
    data.details.forEach((d) => {
      const li = document.createElement('li');
      li.textContent = d;
      detailUl.appendChild(li);
    });
    body.appendChild(detailUl);

    // All do actions
    const doTitle = document.createElement('h4');
    doTitle.textContent = '✅ 하면 좋은 것';
    body.appendChild(doTitle);
    const doUl = document.createElement('ul');
    doUl.className = 'do-list';
    data.doActions.forEach((d) => {
      const li = document.createElement('li');
      li.textContent = d;
      doUl.appendChild(li);
    });
    body.appendChild(doUl);

    // All don't actions
    const dontTitle = document.createElement('h4');
    dontTitle.textContent = '❌ 피하면 좋은 것';
    body.appendChild(dontTitle);
    const dontUl = document.createElement('ul');
    dontUl.className = 'dont-list';
    data.dontActions.forEach((d) => {
      const li = document.createElement('li');
      li.textContent = d;
      dontUl.appendChild(li);
    });
    body.appendChild(dontUl);
  });

  // Summary text
  const summaryRng = createRng(dateStr, deviceId, 'summary');
  const summaryIdx = Math.floor(summaryRng() * COMBO_MESSAGES.length);
  const loveName = ARCHETYPES[appState.loveId].name;
  const moneyName = ARCHETYPES[appState.moneyId].name;
  const healthName = ARCHETYPES[appState.healthId].name;
  $('#report-summary-text').textContent =
    `오늘 당신의 카드는 "${loveName}", "${moneyName}", "${healthName}"입니다. ` +
    COMBO_MESSAGES[summaryIdx] +
    ' 좋은 하루 보내세요!';
}

/* ─────────────────────────────────────
   10. Initialization
   ───────────────────────────────────── */

document.addEventListener('DOMContentLoaded', () => {
  // Bind fortune events
  $('#btn-draw').addEventListener('click', handleDraw);
  $('#btn-redraw').addEventListener('click', handleRedraw);
  $('#btn-share').addEventListener('click', handleShare);
  $('#btn-my-fortune').addEventListener('click', handleMyFortune);

  // Bind tab events
  $$('.tab-bar__btn').forEach((btn) => {
    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
  });

  // Gallery modal events
  $('#gallery-modal .gallery-modal__backdrop').addEventListener('click', closeGalleryModal);
  $('#gallery-modal .gallery-modal__close').addEventListener('click', closeGalleryModal);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !$('#gallery-modal').hidden) closeGalleryModal();
  });

  // Report CTA → switch to report tab
  const goReport = $('#btn-go-report');
  if (goReport) goReport.addEventListener('click', () => switchTab('report'));

  // Report "go fortune" button
  const goFortune = $('#btn-go-fortune');
  if (goFortune) goFortune.addEventListener('click', () => switchTab('fortune'));

  // Init
  initApp();
});
